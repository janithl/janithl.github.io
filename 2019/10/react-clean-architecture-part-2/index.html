<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="author" content="Janith">
    <meta name="description" content="Janith's blog">
    <link rel="icon" href="https://janithl.github.io/favicon.ico">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abhaya+Libre:400,700&amp;subset=sinhala">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/readable/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://janithl.github.io/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://janithl.github.io/theme/css/pygments.css">

    <title>Janith's Blog &ndash; My take on doing 'Clean Architecture' in React (Part 2)</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PHMLN37JY4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PHMLN37JY4');
</script>

    <link href="https://janithl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Janith's Blog Atom" />

<meta name="keywords" content="code, design, js and ts, react, work">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://janithl.github.io/">Janith's Blog</a>
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">

                    <li><a href="https://janithl.github.io/pages/about.html">About</a></li>

                    <li class="active"><a href="https://janithl.github.io/category/general/">General</a></li>
                    <li><a href="https://janithl.github.io/category/links/">Links</a></li>
                    <li><a href="https://janithl.github.io/category/personal/">Personal</a></li>

                    <li><a href="https://github.com/janithl" target="_blank">Github</a></li>

                    <li><a href="https://janithl.github.io/archives.html">Archives</a></li>


                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tags <span class="caret"></span></a>
                      <ul class="dropdown-menu">
                          <li><a href="https://janithl.github.io/tag/biology/">biology</a></li>
                          <li><a href="https://janithl.github.io/tag/casey-neistat/">casey neistat</a></li>
                          <li><a href="https://janithl.github.io/tag/code/">code</a></li>
                          <li><a href="https://janithl.github.io/tag/comics/">comics</a></li>
                          <li><a href="https://janithl.github.io/tag/conflict/">conflict</a></li>
                          <li><a href="https://janithl.github.io/tag/conversations/">conversations</a></li>
                          <li><a href="https://janithl.github.io/tag/data/">data</a></li>
                          <li><a href="https://janithl.github.io/tag/design/">design</a></li>
                          <li><a href="https://janithl.github.io/tag/docker/">docker</a></li>
                          <li><a href="https://janithl.github.io/tag/education/">education</a></li>
                          <li><a href="https://janithl.github.io/tag/films/">films</a></li>
                          <li><a href="https://janithl.github.io/tag/geopolitics/">geopolitics</a></li>
                          <li><a href="https://janithl.github.io/tag/golang/">golang</a></li>
                          <li><a href="https://janithl.github.io/tag/js-and-ts/">js and ts</a></li>
                          <li><a href="https://janithl.github.io/tag/machine-learning/">machine learning</a></li>
                          <li><a href="https://janithl.github.io/tag/music/">music</a></li>
                          <li><a href="https://janithl.github.io/tag/oasis/">oasis</a></li>
                          <li><a href="https://janithl.github.io/tag/people/">people</a></li>
                          <li><a href="https://janithl.github.io/tag/poetry/">poetry</a></li>
                          <li><a href="https://janithl.github.io/tag/politics/">politics</a></li>
                          <li><a href="https://janithl.github.io/tag/prudishness/">prudishness</a></li>
                          <li><a href="https://janithl.github.io/tag/react/">react</a></li>
                          <li><a href="https://janithl.github.io/tag/religion/">religion</a></li>
                          <li><a href="https://janithl.github.io/tag/sexuality/">sexuality</a></li>
                          <li><a href="https://janithl.github.io/tag/sinhala/">sinhala</a></li>
                          <li><a href="https://janithl.github.io/tag/travel/">travel</a></li>
                          <li><a href="https://janithl.github.io/tag/uni/">uni</a></li>
                          <li><a href="https://janithl.github.io/tag/wes-anderson/">wes anderson</a></li>
                          <li><a href="https://janithl.github.io/tag/work/">work</a></li>
                      </ul>
                    </li>

                    <li><a href="https://janithl.github.io/feeds/all.atom.xml">Atom</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
<article>
  <div class="article_title">
    <h3><a href="https://janithl.github.io/2019/10/react-clean-architecture-part-2/">My take on doing 'Clean Architecture' in React (Part 2)</a></h3>
    <p class="lead">What's your type?</p><hr>
  </div>
  <div class="article_text">
    <p><img alt="Core Folder Structure" src="https://janithl.github.io/images/clean-arch-folders.png"></p>
<p><a href="https://janithl.github.io/2019/10/react-clean-architecture-part-1/">In the last part</a>, we broke the application core out, with layers for
entities, usecases, and infrastructure. The <a href="https://github.com/janithl/react-clean-arch/tree/6224ee5f77b1398c41163ffedc78faf786962cc1">example code we used in the last
part (without breaking the core out) can be found on Github</a>.</p>
<p>Now let's look at how we can implement the core. I will be using TypeScript
here because it has two things that we will make implementing Clean Architecture
much easier: types, and interfaces. <a href="https://github.com/microsoft/TypeScript-React-Conversion-Guide">To add TypeScript to an existing React
project</a>, we can simply run:</p>
<div class="highlight"><pre><span></span><code>yarn add -D typescript awesome-typescript-loader source-map-loader
</code></pre></div>

<h3>Entities</h3>
<p>To separate out the core code from the rest of the app, so we'll first create a
subfolder called <code>core</code>, with three subfolders for the Entity, Use Case, and
Infra layers:</p>
<div class="highlight"><pre><span></span><code>src/core
├── entities
├── infrastructure
└── usecases
</code></pre></div>

<p>Inside the <code>entities</code> subfolder, we'll first create the <code>Item</code> class which holds
Item entities. This is a domain entity that will be used throughout the app.</p>
<div class="highlight"><pre><span></span><code><span class="kr">export</span> <span class="kr">class</span> <span class="nx">Item</span> <span class="p">{</span>
  <span class="nx">id</span>: <span class="kt">number</span><span class="p">;</span>
  <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>We will also create an <code>ItemRepository</code> interface that will enable us to abstract
out the API calls (and maybe local storage caching later on) which actually get
us the items.</p>
<div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Item</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./Item&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">ItemRepository</span> <span class="p">{</span>
  <span class="nx">GetItems</span><span class="p">()</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">Item</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Note how it is returning a Promise (with a list of Items), as it will be an async
operation.</p>
<h3>Use Cases</h3>
<p>Then, we implement the <code>UserService</code>. We are implementing the service after defining
an interface because this will make writing tests etc. easier. There are arguments
against single implementation interfaces, but that is a debate for another time. The
service simply gets the items from the repository and returns them.</p>
<div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Item</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../entities/Item&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ItemRepository</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../entities/ItemRepository&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">ItemService</span> <span class="p">{</span>
  <span class="nx">GetItems</span><span class="p">()</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">Item</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">class</span> <span class="nx">ItemServiceImpl</span> <span class="kr">implements</span> <span class="nx">ItemService</span> <span class="p">{</span>
  <span class="nx">itemRepo</span>: <span class="kt">ItemRepository</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="nx">ir</span>: <span class="kt">ItemRepository</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">itemRepo</span> <span class="o">=</span> <span class="nx">ir</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">GetItems</span><span class="p">()</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">Item</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemRepo</span><span class="p">.</span><span class="nx">GetItems</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Notice how the constructor of the service takes an item repository. This is the runtime
injection of dependencies that makes this <strong>super exciting</strong>. We can swap implementations
at runtime and the service has no hard dependencies on <code>infrastructure</code> code, instead
relying on an interface defined at the <code>entity</code> layer.</p>
<h3>Infrastructure</h3>
<p>Finally, we implement the <code>UserRepository</code> we defined in the <code>entity</code> layer. It will
just be a simple API call using <code>fetch()</code>. We should add error handling here, but I've
left it out for now for the sake of simplicity.</p>
<div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Item</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../entities/Item&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ItemRepository</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../entities/ItemRepository&quot;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">ItemDTO</span> <span class="p">{</span>
  <span class="nx">id</span>: <span class="kt">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">name</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">class</span> <span class="nx">ItemRepositoryImpl</span> <span class="kr">implements</span> <span class="nx">ItemRepository</span> <span class="p">{</span>
  <span class="nx">jsonUrl</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span><span class="p">;</span>

  <span class="nx">async</span> <span class="nx">GetItems</span><span class="p">()</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">Item</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">jsonUrl</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">jsonData</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span>: <span class="kt">ItemDTO</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Note how we are defining an <code>ItemDTO</code> here. This is your contract with the API, and will
change with time. The following line:</p>
<div class="highlight"><pre><span></span><code><span class="k">return</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span>: <span class="kt">ItemDTO</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">));</span>
</code></pre></div>

<p>is also very important. This is where the DTO is being mapped to a domain entity. We
can move this transformation to another file as our implementation grows in complexity,
as this code is on an architectural boundary and will change quite frequently.</p>
<h3>All Together Now</h3>
<p>We can now edit our Thunk to use the service instead of directly calling the API:</p>
<div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span>
  <span class="nx">LIST_LOAD_REQUEST</span><span class="p">,</span>
  <span class="nx">LIST_LOAD_SUCCESS</span><span class="p">,</span>
  <span class="nx">LIST_LOAD_FAILURE</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./Item.types&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ItemServiceImpl</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../core/usecases/ItemService&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ItemRepositoryImpl</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../core/infrastructure/ItemRepositoryImpl&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">refreshList</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">dispatch</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">LIST_LOAD_REQUEST</span> <span class="p">});</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">itemRepo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ItemRepositoryImpl</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">itemService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ItemServiceImpl</span><span class="p">(</span><span class="nx">itemRepo</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">itemService</span><span class="p">.</span><span class="nx">GetItems</span><span class="p">();</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">LIST_LOAD_SUCCESS</span><span class="p">,</span> <span class="nx">payload</span><span class="o">:</span> <span class="nx">items</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">LIST_LOAD_FAILURE</span><span class="p">,</span> <span class="nx">error</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<p>The first three lines within the try hold the essence of any dependency injection setup:</p>
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">itemRepo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ItemRepositoryImpl</span><span class="p">();</span>
</code></pre></div>

<p>First, we initalise the repository.</p>
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">itemService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ItemServiceImpl</span><span class="p">(</span><span class="nx">itemRepo</span><span class="p">);</span>
</code></pre></div>

<p>Then, we inject it into the service.</p>
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">itemService</span><span class="p">.</span><span class="nx">GetItems</span><span class="p">();</span>
</code></pre></div>

<p>And finally, we access the methods offered by the service.</p>
<p>It's good to keep these steps explicitly defined, so that the flow is clear and can
be changed in the future.</p>
<hr>
<p>And that's it! We've taken our core out and implemented it in a completely isolated
fashion that doesn't depend on infrastructure concerns. This makes things nice and
testable (I'll try to add some tests to the repo soon!), and makes you think about
the parts of your code that can (and definitely will) change—and how to make sure
that change is contained.</p>
<blockquote>
<p>This is the reason we do not put SQL in JSPs. This is the reason we do not generate
HTML in the modules that compute results. This is the reason that business rules
should not know the database schema. This is the reason we separate concerns.</p>
<p>Another wording for the Single Responsibility Principle is: "Gather together the
things that change for the same reasons. Separate those things that change for
different reasons."</p>
<p>If you think about this you’ll realize that this is just another way to define
cohesion and coupling. We want to increase the cohesion between things that change
for the same reasons, and we want to decrease the coupling between those things
that change for different reasons.</p>
<p>— Uncle Bob</p>
</blockquote>
<hr>
<p>This series of posts is dedicated to <a href="https://www.linkedin.com/in/mahasenbandara/">Mr. Mahasen Bandara</a>, architect extraordinaire,
from whom I had the priviledge of learning about Robert C. Martin and architectural
boundaries and a ton of other architectural and programming practicies.</p>
<p><a href="https://github.com/janithl/react-clean-arch"><strong>The full code for this part can be found on Github.</strong></a></p>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 14 October 2019</p>
    <p>Category: <a href="https://janithl.github.io/category/general/">General</a>
 &ndash; Tags:
      <a href="https://janithl.github.io/tag/code/">code</a>,      <a href="https://janithl.github.io/tag/design/">design</a>,      <a href="https://janithl.github.io/tag/js-and-ts/">js and ts</a>,      <a href="https://janithl.github.io/tag/react/">react</a>,      <a href="https://janithl.github.io/tag/work/">work</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "2019/10/react-clean-architecture-part-2/";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = '//janithl.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>

    </div>

    <div id="ending_message">
        <hr>
        <p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a>.</p>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>
</html>