<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="author" content="Janith">
    <meta name="description" content="Janith's blog">
    <link rel="icon" href="https://janithl.github.io/favicon.ico">

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abhaya+Libre:400,700&amp;subset=sinhala"> 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/readable/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://janithl.github.io/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://janithl.github.io/theme/css/pygments.css">

    <title>Janith's Blog &ndash; July is the month of buses, and 2016 is the year of JS</title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7602960-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

    <link href="https://janithl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Janith's Blog Atom" />

<meta name="keywords" content="code">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://janithl.github.io/">Janith's Blog</a>
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">

                    <li><a href="https://janithl.github.io/pages/about.html">About</a></li>

                    <li class="active"><a href="https://janithl.github.io/category/general/">General</a></li>
                    <li><a href="https://janithl.github.io/category/links/">Links</a></li>
                    <li><a href="https://janithl.github.io/category/personal/">Personal</a></li>

                    <li><a href="https://github.com/janithl" target="_blank">Github</a></li>

                    <li><a href="https://janithl.github.io/archives.html">Archives</a></li>


                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tags <span class="caret"></span></a>
                      <ul class="dropdown-menu">
                          <li><a href="https://janithl.github.io/tag/biology/">biology</a></li>
                          <li><a href="https://janithl.github.io/tag/casey-neistat/">casey neistat</a></li>
                          <li><a href="https://janithl.github.io/tag/code/">code</a></li>
                          <li><a href="https://janithl.github.io/tag/comics/">comics</a></li>
                          <li><a href="https://janithl.github.io/tag/conflict/">conflict</a></li>
                          <li><a href="https://janithl.github.io/tag/conversations/">conversations</a></li>
                          <li><a href="https://janithl.github.io/tag/data/">data</a></li>
                          <li><a href="https://janithl.github.io/tag/design/">design</a></li>
                          <li><a href="https://janithl.github.io/tag/education/">education</a></li>
                          <li><a href="https://janithl.github.io/tag/films/">films</a></li>
                          <li><a href="https://janithl.github.io/tag/geopolitics/">geopolitics</a></li>
                          <li><a href="https://janithl.github.io/tag/machine-learning/">machine learning</a></li>
                          <li><a href="https://janithl.github.io/tag/music/">music</a></li>
                          <li><a href="https://janithl.github.io/tag/oasis/">oasis</a></li>
                          <li><a href="https://janithl.github.io/tag/people/">people</a></li>
                          <li><a href="https://janithl.github.io/tag/politics/">politics</a></li>
                          <li><a href="https://janithl.github.io/tag/prudishness/">prudishness</a></li>
                          <li><a href="https://janithl.github.io/tag/sexuality/">sexuality</a></li>
                          <li><a href="https://janithl.github.io/tag/sinhala/">sinhala</a></li>
                          <li><a href="https://janithl.github.io/tag/travel/">travel</a></li>
                          <li><a href="https://janithl.github.io/tag/uni/">uni</a></li>
                          <li><a href="https://janithl.github.io/tag/wes-anderson/">wes anderson</a></li>
                          <li><a href="https://janithl.github.io/tag/work/">work</a></li>
                      </ul>
                    </li>

                    <li><a href="https://janithl.github.io/feeds/all.atom.xml">Atom</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
<article>
  <div class="article_title">
    <h3><a href="https://janithl.github.io/2016/07/busroutejs/">July is the month of buses, and 2016 is the year of JS</a></h3>
  </div>
  <div class="article_text">
    <p>Yesterday, there I was, minding my own business, when Facebook 
"memories" or whatever threw this curveball at me:</p>
<p><img alt="Bus Route Anniversary" src="https://janithl.github.io/images/bus-route-anni.png" /></p>
<p>Turns out it was exactly 5 years ago that I hacked together 
<a href="https://janithl.blogspot.com/2011/07/bus-route-finder.html">a small piece of PHP</a>, with a <em>liberal</em> amount of SQL logic 
thrown in, and it became sort of popular. We're talking a 
<a href="https://github.com/janithl/Bus-Route-Finder">codebase</a> like this:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> 

<span class="k">function</span> <span class="nf">find3Bus</span><span class="p">(</span><span class="nv">$from</span><span class="p">,</span> <span class="nv">$to</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">global</span> <span class="nv">$dbconn</span><span class="p">;</span>
    <span class="nv">$sql</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;SQL</span>
<span class="s">SELECT s1.`bid` as busid1, s3.`bid` as busid2, s5.`bid` as busid3, </span>
<span class="s">ch1.`changeid` as changeid1, ch2.`changeid` as changeid2, </span>
<span class="s">(s2.`stopNo` - s1.`stopNo`) as dist1, </span>
<span class="s">(s4.`stopNo` - s3.`stopNo`) as dist2, </span>
<span class="s">(s6.`stopNo` - s5.`stopNo`) as dist3</span>
<span class="s">FROM `changeover` AS ch1, `changeover` AS ch2, `stop` AS s1 INNER JOIN `stop` AS s2</span>
<span class="s">ON s1.`bid` = s2.`bid`</span>
<span class="s">INNER JOIN `stop` AS s3</span>
<span class="s">ON s2.`pid` = s3.`pid`</span>
<span class="s">INNER JOIN `stop` AS s4</span>
<span class="s">ON s3.`bid` = s4.`bid`</span>
<span class="s">INNER JOIN `stop` AS s5</span>
<span class="s">ON s4.`pid` = s5.`pid`</span>
<span class="s">INNER JOIN `stop` AS s6</span>
<span class="s">ON s5.`bid` = s6.`bid`  </span>
<span class="s">WHERE s1.`pid` = :from AND s2.`pid` = ch1.`changeid` AND s4.`pid` = ch2.`changeid` </span>
<span class="s">AND s6.`pid` = :to AND s2.`stopNo` &gt; s1.`stopNo` AND s4.`stopNo` &gt; s3.`stopNo` </span>
<span class="s">AND s6.`stopNo` &gt; s5.`stopNo` ORDER BY (dist1 + dist2 + dist3);</span>
<span class="s">SQL;</span>
    <span class="nv">$res</span>    <span class="o">=</span> <span class="nv">$dbconn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;:from&#39;</span> <span class="o">=&gt;</span> <span class="nv">$from</span><span class="p">,</span> <span class="s1">&#39;:to&#39;</span> <span class="o">=&gt;</span> <span class="nv">$to</span><span class="p">));</span>
    <span class="nv">$return</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$res</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span> <span class="o">!=</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$return</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>Yikes.</p>
<p>Anyway, this was hosted on a shitty <a href="http://chavs.000a.biz">000a host</a> that somehow 
still exists on the internet, and it looked like this:</p>
<p><img alt="Bus Route Site Screenshot" src="https://janithl.github.io/images/bus-route-original.png" /></p>
<p>And gave out results that looked like:</p>
<p><img alt="Bus Route Site Results" src="https://janithl.github.io/images/bus-route-original-results.png" /></p>
<p>Which somehow is better looking than anything I've managed since.</p>
<h2>ANYWAY</h2>
<p>I've been wanting to rewrite <a href="https://github.com/janithl/BusRouteJS/commit/eac72894410693c47426720e240a8d5719316b1b">this thing in JS since 2014</a>, 
and I've been grappling with Dijkstra's algorithm for months 
over this. The moment of clarity was realising that bus routes 
<em>aren't graphs, they're linked lists</em>, and using complicated 
graph algorithms is unnecessary.</p>
<p>This Facebook reminder yesterday and having a <em>bit</em> of free
time on my hands led to a 24-hour code sprint that produced
<a href="https://janithl.github.io/BusRouteJS/">this little thingy</a>.</p>
<p>It's not <em>better</em> than the original, for example the same query
as the above Galle Face - Kottawa one gives a stupid result 
like this:</p>
<p><img alt="Bus Route JS Results" src="https://janithl.github.io/images/bus-route-js-results.png" /></p>
<p>The data is ~ 5 years old and needs to be tweaked, and I think 
the algorithms can do with a lot of tweaking, but here it is 
and it runs 100% client-side. Yay 2016!</p>
<h2>What is this CRAP?!</h2>
<p><em>Update:</em> The UI code is now completely React-based! All clean and 
beautiful. Yay!</p>
<p>"Janith", I hear you say, "you go around the place talking about 
the how great React is and how important readable code is, and 
then you write crap UI code like this:"</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;col-xs-12&quot;&gt;&#39;</span> <span class="o">+</span> 
        <span class="nx">renderRoute</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">from</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">to</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">distance</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">routes</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;col-xs-6&quot;&gt;&#39;</span> <span class="o">+</span> 
        <span class="nx">renderRoute</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">from</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">distance</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">routes</span><span class="p">)</span> <span class="o">+</span> 
    <span class="s1">&#39;&lt;/div&gt;&lt;div class=&quot;col-xs-6&quot;&gt;&#39;</span> <span class="o">+</span>
        <span class="nx">renderRoute</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">route</span><span class="p">.</span><span class="nx">to</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">distance</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">routes</span><span class="p">)</span> <span class="o">+</span> 
    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;col-xs-4&quot;&gt;&#39;</span> <span class="o">+</span> 
        <span class="nx">renderRoute</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">from</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">distance</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">routes</span><span class="p">)</span> <span class="o">+</span> 
    <span class="s1">&#39;&lt;/div&gt;&lt;div class=&quot;col-xs-4&quot;&gt;&#39;</span> <span class="o">+</span>
        <span class="nx">renderRoute</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">distance</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">routes</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/div&gt;&lt;div class=&quot;col-xs-4&quot;&gt;&#39;</span> <span class="o">+</span>
        <span class="nx">renderRoute</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">changes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">route</span><span class="p">.</span><span class="nx">to</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">distance</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">routes</span><span class="p">)</span> <span class="o">+</span> 
    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;panel panel-warning&quot;&gt;&lt;div class=&quot;panel-heading&quot;&gt;&lt;h3 class=&quot;panel-title&quot;&gt;&#39;</span> <span class="o">+</span> 
    <span class="s1">&#39;&lt;span class=&quot;glyphicon glyphicon-star&quot;&gt;&lt;/span&gt; Recommended Route&lt;/h3&gt;&lt;/div&gt;&lt;div class=&quot;panel-body row&quot;&gt;&#39;</span> <span class="o">+</span> 
    <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;panel panel-default&quot;&gt;&lt;div class=&quot;panel-body row&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Okay, I'm a hypocrite. I only had 24 hours to write this and I 
cut some corners. REACT TAKES LIKE <strong>6 HOURS</strong> TO SET UP, OKAY? </p>
<p>I'm sorry. :C</p>
<p>(It took a couple of days of hard toil to finally convert the UI 
code to React. I would never have made my self-imposed 24 hour 
deadline had I gone with React the first time.)</p>
<h2>Why's half of router.js stolen code?</h2>
<p>Let's face it, we all do this. Copy stuff <em>gedi pitin</em> from 
StackOverflow. I just linked back to the sources, legal 
ramifications be damned.</p>
<h2>Is this bus thing the only good thing you've written? Are you flogging a dead horse?</h2>
<p>I wouldn't call it good, but yes.</p>
<h2>What now?</h2>
<p>I've barely tested it, so I'll probably make some tweaks here 
and there. The code, as usual, is on <a href="https://github.com/janithl/BusRouteJS">Github and MIT licensed</a>.</p>
<h2>TL;DR</h2>
<p><a href="https://janithl.github.io/BusRouteJS/">Go to this page, and it'll throw you not great bus route suggestions</a></p>
  </div>
  <div class="article_meta">
    <p>Posted on: Fri 22 July 2016</p>
    <p>Category: <a href="https://janithl.github.io/category/general/">General</a>
 &ndash; Tags:
      <a href="https://janithl.github.io/tag/code/">code</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "2016/07/busroutejs/";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = '//janithl.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>

    </div>

    <div id="ending_message">
        <hr>
        <p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a>.</p>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>
</html>